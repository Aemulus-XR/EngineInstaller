# EngineInstaller Project Instructions

## Project Overview
This project is developing a WiX-based installer for the Aemulus-XR Unreal Engine custom build. The installer will package and deploy the engine build generated by the `GenerateInstallBuild.bat` script in the UEOculusDrop repository.

## Related Repositories
- **UEOculusDrop**: `e:\1\GitRepos\Aemulus-XR\UEOculusDrop` - The main Unreal Engine repository
  - Build script: `GenerateInstallBuild.bat`
  - Build output: `LocalBuilds/Engine/Windows/` - The compiled engine files to be packaged
- **EngineInstaller**: `e:\1\GitRepos\Aemulus-XR\EngineInstaller` - This installer project

## Technical Goals
- Create an interactive WiX installer
- Package the contents of `UEOculusDrop/LocalBuilds/Engine/Windows/`
- Provide a user-friendly installation experience
- Handle installation, updates, and uninstallation properly

## Current Status
- Project initialized from ScooterGitTemplate
- Version: 0.0.0 (pre-release)
- WiX Toolset: v4.0.1 installed (.NET tool)
- .NET SDK: 9.0.308 available
- Source directory structure: Created in `src/AemulusEngineInstaller/`
- Heat harvesting: Configured to auto-generate file components
- **✓ FIRST SUCCESSFUL BUILD ACHIEVED** - MSI installer compiles successfully with test files
- Test folder: `src/TestEngineFiles/` for fast development iteration

## Development Guidelines
- Use conventional commits for automated versioning
  - `feat:` for new features (bumps MINOR version)
  - `fix:` for bug fixes (bumps PATCH version)
  - `feat!:` or `fix!:` for breaking changes (bumps MAJOR version)
- Keep CHANGELOG.md and VERSION.md updated (handled by Release-Please)
- Document all decisions and architectural choices here

## Build Process
1. Run `GenerateInstallBuild.bat` in UEOculusDrop
2. Engine files are generated in `LocalBuilds/Engine/Windows/`
   - Contains: Engine/, FeaturePacks/, Samples/, Templates/
   - Key executable: `Engine/Binaries/Win64/UnrealEditor.exe`
3. WiX installer packages these files
4. Output: Distributable installer package (MSI)

## Installation Details
- **Source folder**: `UEOculusDrop/LocalBuilds/Engine/Windows/`
- **Target folder name**: `UE_5.6_OculusDrop` (version may change)
- **Current version**: 5.6
- **Primary executable**: `Engine/Binaries/Win64/UnrealEditor.exe`
- **Shortcuts**: Desktop and Start Menu shortcuts to UnrealEditor.exe
- **Structure to install**:
  - Engine/ (core engine files, binaries, plugins, content)
  - FeaturePacks/
  - Samples/
  - Templates/

## Questions to Resolve
- [ ] What registry entries are needed? (Engine location, version info)

## Decisions Made
- ✓ Install folder will be named `UE_5.6_OculusDrop` (not "Windows")
- ✓ Shortcuts will point to UnrealEditor.exe
- ✓ Using WiX v4 (.NET-based toolchain)
- ✓ **Installer name**: `AemulusXR-UE-5.6-OculusDrop.msi`
- ✓ **Default install path**: `C:\Program Files\Aemulus-XR\UE_5.6_OculusDrop`
- ✓ **Custom paths**: Yes, users can choose installation location
- ✓ **Shortcuts**: Both Desktop and Start Menu
- ✓ **File associations**: No .uproject associations
- ✓ **Prerequisites**: No automatic prerequisite checks/installs
- ✓ **Version handling**: Upgrade in place (not side-by-side)

## Resources
- WiX Toolset: https://wixtoolset.org/
- Unreal Engine documentation
- ScooterGitTemplate: https://github.com/ScottKirvan/ScooterGitTemplate

## Technical Implementation Details

### WiX Heat Configuration
The installer uses WiX Heat to automatically harvest all engine files during build:

- **EngineComponents**: Harvests `Engine/` folder
- **FeaturePacksComponents**: Harvests `FeaturePacks/` folder
- **SamplesComponents**: Harvests `Samples/` folder
- **TemplatesComponents**: Harvests `Templates/` folder

Each harvest uses:
- `SuppressRootDirectory=true`: Doesn't create an extra directory layer
- `PreprocessorVariable=var.SourceDir`: References the source path variable

### Build-Time Variables
- `SourceDir`: Points to `UEOculusDrop/LocalBuilds/Engine/Windows/`
  - Can be overridden via command line: `dotnet build -p:SourceDir="C:\CustomPath"`
  - Default set in `.csproj` file

### GUIDs
- **UpgradeCode**: `12345678-1234-1234-1234-123456789012` (MUST stay the same across versions)
- **Component GUID**: `87654321-4321-4321-4321-210987654321` (for shortcuts component)

> **Important**: The UpgradeCode must remain constant across all versions to enable upgrade-in-place functionality!

## Potential Issues with Large Engine Builds

### Path Length Issues
- **Windows MAX_PATH limit**: 260 characters
- **WiX v4**: Better handling than v3, but still potential issues
- **Mitigation**: WiX uses short file names in MSI tables, but long paths can still cause problems during build
- **Solution**: If path length errors occur, consider using shorter build output paths or Windows Long Path support

### Build Performance
- **Heat harvesting**: Will scan thousands of files (10,000+ in full UE build)
- **Expected build time**: 2-10 minutes for full engine (vs seconds for test files)
- **Memory usage**: Can spike during component generation
- **MSI size**: Expect 8-15 GB for full engine installation

### File Count Issues
- **Windows Installer limit**: 32,767 files per component (we should be under this)
- **Cabinet file size**: Single CAB file can be very large (8+ GB)
- **Compression time**: CAB compression is slow for large builds

### Known WiX Issues
- **Heat deprecation warning**: Expected (HEAT5149) - Heat is deprecated in WiX v7
- **Assembly harvest warnings**: Expected for non-.NET executables (HEAT5151)
- **Security vulnerabilities**: WiX 4.0.1 has known vulns - consider updating to latest 4.x when available

### Recommendations for First Production Build
1. **Increase build timeout**: May need 10-15 minutes
2. **Close other applications**: Free up memory
3. **Watch for errors**: Path length, file locks, permissions
4. **Test in VM first**: Don't test on your development machine initially

## Notes
(Add ongoing notes, decisions, and important context here)
