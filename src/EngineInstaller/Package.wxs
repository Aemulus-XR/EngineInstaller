<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">

  <!-- Product Definition -->
  <Package
    Name="Unreal Engine 5.6 OculusDrop"
    Manufacturer="Aemulus-XR"
    Version="5.6.0.0"
    UpgradeCode="12345678-1234-1234-1234-123456789012"
    Language="1033"
    Codepage="1252"
    InstallerVersion="500"
    Compressed="yes">

    <SummaryInformation
      Keywords="Installer"
      Description="Unreal Engine 5.6 OculusDrop Edition"
      Manufacturer="Aemulus-XR" />

    <!-- Upgrade logic - upgrade in place -->
    <MajorUpgrade
      DowngradeErrorMessage="A newer version of [ProductName] is already installed."
      AllowSameVersionUpgrades="yes" />

    <!-- Ensure 64-bit Windows -->
    <Launch Condition="VersionNT64" Message="This application requires a 64-bit operating system." />

    <!-- Media definition -->
    <Media Id="1" Cabinet="Engine.cab" EmbedCab="yes" />

    <!-- Icon for Add/Remove Programs -->
    <!-- TODO: Re-enable once file path mapping is working -->
    <!-- <Icon Id="UnrealEditor.exe" SourceFile="!(bindpath.SourceDir)\Engine\Binaries\Win64\UnrealEditor.exe" /> -->
    <!-- <Property Id="ARPPRODUCTICON" Value="UnrealEditor.exe" /> -->

    <!-- Installation directory structure -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="ManufacturerFolder" Name="Aemulus-XR">
        <Directory Id="INSTALLFOLDER" Name="UE_5.6_OculusDrop">
          <!-- Engine files will be added here via Heat -->
          <Directory Id="EngineFolder" Name="Engine">
            <Directory Id="BinariesFolder" Name="Binaries">
              <Directory Id="Win64Folder" Name="Win64" />
            </Directory>
          </Directory>
          <Directory Id="FeaturePacksFolder" Name="FeaturePacks" />
          <Directory Id="SamplesFolder" Name="Samples" />
          <Directory Id="TemplatesFolder" Name="Templates" />
        </Directory>
      </Directory>
    </StandardDirectory>

    <!-- Desktop shortcut -->
    <StandardDirectory Id="DesktopFolder" />

    <!-- Start Menu folder -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Unreal Engine 5.6" />
    </StandardDirectory>

    <!-- Main application component -->
    <Component Id="UnrealEditorShortcuts" Directory="INSTALLFOLDER" Guid="87654321-4321-4321-4321-210987654321">

      <!-- Start Menu Shortcut -->
      <Shortcut
        Id="StartMenuShortcut"
        Directory="ApplicationProgramsFolder"
        Name="Unreal Editor 5.6"
        Description="Unreal Engine 5.6 OculusDrop Edition"
        Target="[Win64Folder]UnrealEditor.exe"
        WorkingDirectory="INSTALLFOLDER" />

      <!-- Desktop Shortcut -->
      <Shortcut
        Id="DesktopShortcut"
        Directory="DesktopFolder"
        Name="Unreal Editor 5.6"
        Description="Unreal Engine 5.6 OculusDrop Edition"
        Target="[Win64Folder]UnrealEditor.exe"
        WorkingDirectory="INSTALLFOLDER" />

      <!-- Required for shortcuts -->
      <RegistryValue
        Root="HKCU"
        Key="Software\Aemulus-XR\UnrealEngine\5.6"
        Name="installed"
        Type="integer"
        Value="1"
        KeyPath="yes" />

      <!-- Installation path registry entry -->
      <RegistryValue
        Root="HKCU"
        Key="Software\Aemulus-XR\UnrealEngine\5.6"
        Name="InstallPath"
        Type="string"
        Value="[INSTALLFOLDER]" />

      <!-- Clean up shortcuts on uninstall -->
      <RemoveFolder Id="RemoveStartMenuFolder" Directory="ApplicationProgramsFolder" On="uninstall" />
      <RemoveFolder Id="RemoveDesktopShortcut" Directory="DesktopFolder" On="uninstall" />
    </Component>

    <!-- Feature definition -->
    <Feature Id="ProductFeature" Title="Unreal Engine 5.6" Level="1">
      <ComponentRef Id="UnrealEditorShortcuts" />
      <!-- Heat-generated component groups -->
      <ComponentGroupRef Id="EngineComponents" />
      <ComponentGroupRef Id="FeaturePacksComponents" />
      <ComponentGroupRef Id="SamplesComponents" />
      <ComponentGroupRef Id="TemplatesComponents" />
    </Feature>

    <!-- UI Definition -->
    <ui:WixUI Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

  </Package>

</Wix>
